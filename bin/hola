#!/usr/bin/env ruby
require 'json'

# No warnings
BEGIN { $VERBOSE = nil }

class Hola
  def initialize
    load_env_vars
    say_hello
  end

  def say_hello
    puts "Hello #{config['name']}, you're doing great!"
  end

  private

  def load_env_vars
    # This file is generated by boiler
    File.readlines("/etc/hola_env").each do |line|
      values = line.split("=")
      ENV[values[0]] = values[1]
    end if unraid?
  end

  def config
    # This env variable is generated by boiler
    config_path = ENV['HOLA_CONFIG_PATH'] || 'config'
    @config ||= JSON.parse File.read "#{config_path}/hola.json"
  end

  def unraid?
    /unraid/i =~ `uname -a`
  end
end

# Kick it off
Hola.new
